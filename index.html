<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediBook – Medical Appointments</title>
<style>
/* ---------- Base & Layout ---------- */
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,Arial,sans-serif}
body{background:#f4f7fb;color:#333;line-height:1.6}
header{background:#4a90e2;color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10}
header h1{font-size:1.8rem;cursor:pointer}
nav a{color:#fff;margin-left:1.5rem;text-decoration:none;font-weight:500;transition:.3s}
nav a:hover{opacity:.8}
section{max-width:900px;margin:2rem auto;padding:1rem;display:none;animation:fade .4s ease}
.active{display:block}
h2{margin-bottom:1rem;text-align:center}
.card{background:#fff;border-radius:12px;padding:1.5rem;margin:1rem 0;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
label{display:block;margin:.7rem 0 .2rem}
input,select,button{width:100%;padding:.6rem;margin-bottom:1rem;border:1px solid #ccc;border-radius:8px}
button{background:#4a90e2;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:.3s;border:none}
button:hover{background:#357ab7}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
.doctor-card{padding:1rem;text-align:center;border:1px solid #eee;border-radius:10px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.08)}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<header>
  <h1 onclick="showPage('home')">MediBook</h1>
  <nav>
    <a href="#" onclick="showPage('home')">Home</a>
    <a href="#" onclick="loadDoctors()">Doctors</a>
    <a href="#" onclick="loadBook()">Book</a>
    <a href="#" onclick="showPage('myapps')">My Appointments</a>
  </nav>
</header>

<!-- Home -->
<section id="home" class="active">
  <h2>Welcome to MediBook</h2>
  <p class="card">Book your doctor appointments quickly and securely. Use the navigation above to explore doctors, book an appointment, or view your bookings.</p>
</section>

<!-- Doctors -->
<section id="doctors">
  <h2>Our Doctors</h2>
  <div id="doctor-list" class="grid"></div>
</section>

<!-- Book Appointment -->
<section id="book">
  <h2>Book an Appointment</h2>
  <form id="appointment-form" class="card">
    <label>Your User ID</label>
    <input type="number" id="userId" required>
    <label>Select Doctor</label>
    <select id="doctorSelect" required></select>
    <label>Date & Time</label>
    <input type="datetime-local" id="apptTime" required>
    <button type="submit">Book</button>
  </form>
  <p id="bookMsg"></p>
</section>

<!-- My Appointments -->
<section id="myapps">
  <h2>My Appointments</h2>
  <div class="card">
    <label>User ID</label>
    <input type="number" id="lookupUserId">
    <button onclick="fetchAppointments()">Show Appointments</button>
  </div>
  <div id="appt-list"></div>
</section>

<script>
// ---------- Config ----------
const API = "http://127.0.0.1:8000";   // FastAPI base URL

// ---------- Navigation ----------
function showPage(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ---------- Load Doctors ----------
async function loadDoctors(){
  showPage('doctors');
  const res = await fetch(`${API}/doctors`);
  const docs = await res.json();
  const list = document.getElementById('doctor-list');
  list.innerHTML = "";
  docs.forEach(d=>{
    const c = document.createElement('div');
    c.className = "doctor-card";
    c.innerHTML = `<h3>${d.name}</h3><p>${d.specialty}</p>`;
    list.appendChild(c);
  });
  // also fill select for booking
  const sel = document.getElementById('doctorSelect');
  sel.innerHTML = docs.map(d=>`<option value="${d.id}">${d.name} – ${d.specialty}</option>`).join('');
}

// ---------- Book Appointment ----------
document.getElementById('appointment-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const payload = {
    user_id: +document.getElementById('userId').value,
    doctor_id: +document.getElementById('doctorSelect').value,
    appointment_time: document.getElementById('apptTime').value
  };
  const r = await fetch(`${API}/appointments/`,{
    method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
  });
  document.getElementById('bookMsg').textContent =
      r.ok ? "✅ Appointment booked!" : "❌ Booking failed.";
  document.getElementById('appointment-form').reset();
});

// ---------- Fetch Appointments ----------
async function fetchAppointments(){
  const uid = document.getElementById('lookupUserId').value;
  if(!uid) return;
  const r = await fetch(`${API}/appointments/${uid}`);
  const apps = await r.json();
  const div = document.getElementById('appt-list');
  div.innerHTML = apps.length
   ? apps.map(a=>`<div class="card"><b>ID:</b> ${a.id} — Doctor ${a.doctor_id} on ${new Date(a.appointment_time).toLocaleString()} [${a.status}]</div>`).join('')
   : "<p class='card'>No appointments found.</p>";
}
</script>
</body>
</html>
